{# QS Signal Analysis Template - Optimized for Execution Validation #}

## QS SIGNAL TO VALIDATE

**Ticker:** {{ signal.ticker or signal.tickers_raw or 'UNKNOWN' }}
**Direction:** {{ signal.direction or 'UNKNOWN' }}
{% if signal.strike %}**Strike:** ${{ '{:.2f}'.format(signal.strike) }}{% endif %}
{% if signal.expiry %}**Expiry:** {{ signal.expiry }}{% endif %}

### Signal Parameters
- **Entry Price:** {% if signal.entry_price %}${{ '{:.2f}'.format(signal.entry_price) }}{% else %}MARKET{% endif %}
- **Target:** {% if signal.target_price %}${{ '{:.2f}'.format(signal.target_price) }}{% else %}NOT SPECIFIED{% endif %}
- **Stop Loss:** {% if signal.stop_loss %}${{ '{:.2f}'.format(signal.stop_loss) }}{% else %}NOT SPECIFIED{% endif %}
- **Confidence:** {% if signal.confidence %}{{ '{:.0%}'.format(signal.confidence) }}{% else %}N/A{% endif %}

{% if signal.entry_price and signal.target_price and signal.stop_loss %}
### Signal's R:R (at signal time)
{% set risk = signal.entry_price - signal.stop_loss %}
{% set reward = signal.target_price - signal.entry_price %}
{% set rr = (reward / risk) if risk > 0 else 0 %}
- Risk: ${{ '{:.2f}'.format(risk) }} per contract
- Reward: ${{ '{:.2f}'.format(reward) }} per contract
- R:R Ratio: {{ '{:.2f}'.format(rr) }}:1 {% if rr < 1.5 %}⚠️ LOW{% elif rr >= 2 %}✅ GOOD{% endif %}
{% endif %}

---

## RAW SIGNAL CONTENT

{{ signal.full_content or 'No content available' }}

---

## TRADING CONFIG

- Max Position Size: {{ '{:.0%}'.format(config.max_position_size_percent) }} of portfolio
- Max Concurrent Positions: {{ config.max_concurrent_positions }}
- Max VIX Level: {{ config.max_vix_level }}
- Execute Orders: {{ 'LIVE' if config.execute_orders else 'DRY RUN (simulation)' }}

---

## YOUR TASK

1. **FIRST:** Call `get_current_time` to check if market is open
2. **IF CLOSED:** Skip immediately, no need for more tools
3. **IF OPEN:** 
   - Call `get_option_chain` for {{ signal.ticker }} to get CURRENT option price
   - Calculate CURRENT R:R based on current prices
   - If R:R < 1.5 → Skip
   - If R:R >= 1.5 → Check account and positions, then execute

4. **Design bracket:** If executing, specify optimal entry/target/stop based on CURRENT prices

**Output your decision as JSON.**
